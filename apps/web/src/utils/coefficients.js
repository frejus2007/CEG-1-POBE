export const COEFFICIENTS_DATA = {
  "1er_cycle": {
    "6ème": {
      "Français": 1,
      "Communication Écrite": 1,
      "Lecture": 1,
      "Langue Vivante 1": 1,
      "Anglais": 1,
      "Allemand": 1,
      "Espagnol": 1,
      "Histoire-Géo": 1,
      "Mathématiques": 1,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 1,
      "EPS": 1,
      "Conduite": 1
    },
    "5ème": {
      "Français": 1,
      "Communication Écrite": 1,
      "Lecture": 1,
      "Langue Vivante 1": 1,
      "Anglais": 1,
      "Allemand": 1,
      "Espagnol": 1,
      "Histoire-Géo": 1,
      "Mathématiques": 1,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 1,
      "EPS": 1,
      "Conduite": 1
    },
    "4ème": { 
      "Français": 2,
      "Communication Écrite": 2,
      "Lecture": 2,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 3,
      "PCT": 2,
      "Physique-Chimie": 2,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1
    },
    "3ème": { 
      "Français": 2,
      "Communication Écrite": 2,
      "Lecture": 2,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 3,
      "PCT": 2,
      "Physique-Chimie": 2,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1
    }
  },

  "2nd_cycle": {
    "2nde_A1": {
      "Français": 2,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Philosophie": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 1,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 1,
      "EPS": 1,
      "Conduite": 1 
    },
    "2nde_A2": {
      "Français": 2,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Philosophie": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 1,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 1,
      "EPS": 1,
      "Conduite": 1 
    },
    "2nde_B": {
      "Français": 2,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Langue Vivante 2": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Philosophie": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 1,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 1,
      "EPS": 1,
      "Conduite": 1 
    },
    "2nde_C": {
      "Français": 1,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 3,
      "PCT": 3,
      "Physique-Chimie": 3,
      "SVT": 3,
      "EPS": 1,
      "Conduite": 1 
    },
    "2nde_D": {
      "Français": 1,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 3,
      "PCT": 3,
      "Physique-Chimie": 3,
      "SVT": 3,
      "EPS": 1,
      "Conduite": 1 
    },

    "1ère_A1": {
      "Français": 5,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Philosophie": 4,
      "Histoire-Géo": 5,
      "Mathématiques": 2,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1 
    },
    "1ère_A2": {
      "Français": 4,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Philosophie": 3,
      "Histoire-Géo": 4,
      "Mathématiques": 2,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1 
    },
    "1ère_B": {
      "Français": 4,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 1,
      "Allemand": 1,
      "Espagnol": 1,
      "Philosophie": 3,
      "Histoire-Géo": 4,
      "Mathématiques": 2,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1 
    },
    "1ère_C": {
      "Français": 2,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 5,
      "PCT": 5,
      "Physique-Chimie": 5,
      "SVT": 5,
      "EPS": 1,
      "Conduite": 1 
    },
    "1ère_D": {
      "Français": 2,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 4,
      "PCT": 4,
      "Physique-Chimie": 4,
      "SVT": 5,
      "EPS": 1,
      "Conduite": 1 
    },

    "Tle_A1": {
      "Français": 6,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Philosophie": 4,
      "Histoire-Géo": 5,
      "Mathématiques": 2,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1 
    },
    "Tle_A2": {
      "Français": 4,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 2,
      "Allemand": 2,
      "Espagnol": 2,
      "Philosophie": 3,
      "Histoire-Géo": 5,
      "Mathématiques": 2,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1 
    },
    "Tle_B": {
      "Français": 4,
      "Langue Vivante 1": 3,
      "Anglais": 3,
      "Langue Vivante 2": 1,
      "Allemand": 1,
      "Espagnol": 1,
      "Philosophie": 3,
      "Histoire-Géo": 4,
      "Mathématiques": 2,
      "PCT": 1,
      "Physique-Chimie": 1,
      "SVT": 2,
      "EPS": 1,
      "Conduite": 1 
    },
    "Tle_C": {
      "Français": 2,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 6,
      "PCT": 5,
      "Physique-Chimie": 5,
      "SVT": 5,
      "EPS": 1,
      "Conduite": 1 
    },
    "Tle_D": {
      "Français": 2,
      "Langue Vivante 1": 2,
      "Anglais": 2,
      "Histoire-Géo": 2,
      "Mathématiques": 4,
      "PCT": 4,
      "Physique-Chimie": 4,
      "SVT": 5,
      "EPS": 1,
      "Conduite": 1 
    }
  }
};

export const getCycleByLevel = (level) => {
  const levelText = level?.toString() || '';
  if (['6ème', '5ème', '4ème', '3ème'].some(l => levelText.startsWith(l))) {
    return 1;
  }
  if (['2nde', '1ère', 'Tle'].some(l => levelText.startsWith(l))) {
    return 2;
  }
  return null;
};

export const getCoefficient = (className, subjectName) => {
  const cycle = getCycleByLevel(className);
  const cycleKey = cycle === 1 ? "1er_cycle" : "2nd_cycle";
  
  // Normalize level name for cycle 2
  let searchKey = className.split(' ')[0]; // ex: "3ème" or "2nde"
  
  // For cycle 2, we need the full prefix like "2nde_A1"
  if (cycle === 2) {
    // Try to match the full name prefix (e.g. "2nde A1")
    const match = className.replace(' ', '_');
    searchKey = Object.keys(COEFFICIENTS_DATA[cycleKey]).find(k => match.startsWith(k)) || searchKey;
  }

  const levels = COEFFICIENTS_DATA[cycleKey];
  const levelData = levels[searchKey];

  if (levelData) {
    // Try exact match or normalization
    if (levelData[subjectName]) return levelData[subjectName];
    
    // Normalize common naming variations if needed
    const normalizedSubj = subjectName.replace('-', '_').replace(' ', '_');
    if (levelData[normalizedSubj]) return levelData[normalizedSubj];
  }

  return 1; // Default fallback
};
